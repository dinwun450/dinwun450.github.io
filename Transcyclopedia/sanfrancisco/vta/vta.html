<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcyclopedia San Francisco: Santa Clara Valley Transportation Authority</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="vta.css">
    <script src="vta.js"></script>
</head>

<body>
    <nav id="navbar">
        <a href="https://dinwun450.github.io/Transcyclopedia/trcypdia_main.html" class="brand">
            <!--<i class="fa-solid fa-earth-americas"></i>-->
            <span id="globe"><i class="fa-solid fa-earth-americas"></i></span>
            <span>Transcyclopedia</span>
        </a>
        <ul class="nav-links">
            <input type="checkbox" id="checkbox_toggle" />
            <label for="checkbox_toggle" class="hamburger">&#9776;</label>
            <div class="menu">
                <li style="--i:0;">
                    <a href="#">
                        <span>Menu</span>
                        <span><ion-icon name="home-outline"></ion-icon></span>
                    </a>
                </li>
                <li style="--i:1;">
                    <a href="#">
                        <span>Agency</span>
                        <span><ion-icon name="business-outline"></ion-icon></span>
                    </a>
                </li>
                <li style="--i:2;">
                    <a href="#">
                        <span>Alerts</span>
                        <span><ion-icon name="warning-outline"></ion-icon></span>
                    </a>
                </li>
                <li style="--i:3;">
                    <a href="#">
                        <span>Lines</span>
                        <span><ion-icon name="map-outline"></ion-icon></span>
                    </a>
                </li>
                <li style="--i:4;">
                    <a href="#">
                        <span>About</span>
                        <span><ion-icon name="information-circle-outline"></ion-icon></span>
                    </a>
                </li>
            </div>
        </ul>
    </nav>
    <div class="main">
        <div class="topfooter">
            <h1 style="color: white;" id="titleofsection">Santa Clara Valley Transportation Authority</h1>
        </div>
        <div class="tab">
            <button class="tablinks" onclick="openTab(event, 'info')" id="defaulttab">About VTA</button>
            <button class="tablinks" onclick="openTab(event, 'lines')">Lines</button>
            <button class="tablinks" onclick="openTab(event, 'departures_lr')">VTA Light Rail</button>
            <button class="tablinks" onclick="openTab(event, 'departures_bus')">Bus</button>
        </div>

        <div id="info" class="tabcontent">
            <h2>About VTA</h2>
            <p id="about_content">
                The Santa Clara Valley Transportation Authority, more commonly known simply as the Valley Transportation Authority (VTA), 
                is a special district responsible for public transit services, congestion management, specific highway improvement projects, 
                and countywide transportation planning for Santa Clara County, California. It serves San Jose, California, and the surrounding 
                Silicon Valley. It is one of the governing parties for the Caltrain commuter rail line that serves the county. In 2022, the 
                VTA's public transportation services had a combined ridership of 21,381,600, or about 85,800 per weekday as of the second quarter of 2023.
                <a href="https://en.wikipedia.org/wiki/Santa_Clara_Valley_Transportation_Authority">Wikipedia</a>
            </p>
        </div>
        <div id="lines" class="tabcontent">
            <h2>Lines</h2>
            <h4 class="buslines">Bus</h3>
            <ul id="vta_lines">
                <li id="each_line">
                    <div id="line">-</div>
                    <div id="route_desc">(Loading)</div>
                </li>
            </ul>
            <h4 class="lrlines">Light Rail</h4>
            <ul id="vta_lr_lines">
                <li id="each_line_lr">
                    <div id="line_lr">-</div>
                    <div id="route_desc_lr">(Loading)</div>
                </li>
            </ul>
        </div>
        <div id="departures_lr" class="tabcontent">
            <h2>VTA Light Rail</h2>
            <input type="text" placeholder="Search for a station.." onkeydown="keydownlr()" id="stationgetter"
                autocomplete="off">
            <p class="headerforstop">Departures for &nbsp;<span id="stationname">---</span></p>
            <ul id="list_of_departures">
                <li id="line_for_departure">
                    <div class="wrapper_for_departure">
                        <div id="line_for_each_departure">-</div> <div id="route_headsign"><p id="isscroll">(None)</p></div> <span id="route_depart">Enter a specific station by their station ID</span>
                    </div>
                </li>
            </ul>
            <h3>Alerts Today</h3>
            <ul id="list_of_alerts">
                <li id="alert_entity">
                    <p>Once you typed down the station by their ID, the advisories will display here.</p>
                </li>
            </ul>
            <button id="clearall" onclick="clearAllDepartures()">Clear</button>
        </div>
        <div id="departures_bus" class="tabcontent">
            <h2>Bus</h2>
            <input type="text" placeholder="Search for a station.." onkeydown="keydownbus()" id="busgetter"
                autocomplete="off">
            <p class="headerforstop2">Departures for &nbsp;<span id="stopname">---</span></p>
            <ul id="list_of_departures2">
                <li id="line_for_departure2">
                    <div class="wrapper_for_departure2">
                        <div id="line_for_each_departure2">-</div> <div id="route_headsign2"><p id="isscroll2">(None)</p></div> <span id="route_depart2">Enter a specific stop by their stop ID</span>
                    </div>
                </li>
            </ul>
            <h3>Alerts Today</h3>
            <ul id="list_of_alerts2">
                <li id="alert_entity2">
                    <p>Once you typed down the station by their ID, the advisories will display here.</p>
                </li>
            </ul>
            <button id="clearall2" onclick="clearAllDepartures2()">Clear</button>
        </div>
    </div>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <script>
        let lastScrollTop = 0;
        var deviceWidth = window.innerWidth;
        var counter = 0;
        var counter_b = 0;

        navbar = document.getElementById("navbar");
        window.addEventListener("scroll", function () {
            let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            if (scrollTop > lastScrollTop) {
                navbar.classList.add("icon");
            } else {
                navbar.classList.remove("icon");
            }
            lastScrollTop = scrollTop;
        })

        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }
        document.getElementById("defaulttab").click();

        function keydownlr(e) {
            e = e || window.event;
            if (e.keyCode === 13) {
                callStopLR();
            }
        }

        function callStopLR() {
            var obtainValue = document.getElementById("stationgetter").value;
            var stopCall = new XMLHttpRequest();
            stopCall.open("GET", `https://transit.land/api/v2/rest/stops?served_by_onestop_ids=o-9q9-vta&served_by_route_type=0&stop_id=${obtainValue}&api_key=x5unflDSbpKEWnThyfmteM8MHxIsg3eL`);
            stopCall.onreadystatechange = function() {
                if (stopCall.readyState === 4 && stopCall.status === 200) {
                    var stopId = JSON.parse(stopCall.responseText);
                    
                    if (stopId.stops.length === 0) {
                        document.getElementById("route_depart").innerHTML = "There's no stop departures at this moment.";
                    }
                    else {
                        var stopIdSpecified = stopId.stops[0].stop_code;
                        var stopName = stopId.stops[0].stop_name;
                        
                        document.getElementById("stationname").innerHTML = stopName;
                        gatherDeparturesLR(stopIdSpecified);
                    }
                }
            }
            stopCall.send();
        }

        function gatherDeparturesLR(stopID_input) {
            var departureRequest = new XMLHttpRequest();
            departureRequest.open("GET", `https://transit.land/api/v2/rest/stops/f-sf~bay~area~rg:${stopID_input}/departures?api_key=x5unflDSbpKEWnThyfmteM8MHxIsg3eL&include_alerts=true`);
            departureRequest.onreadystatechange = function() {
                if (departureRequest.readyState === 4 && departureRequest.status === 200) {
                    var compileDepartures = JSON.parse(departureRequest.responseText);

                    for (var i = 0; i < compileDepartures.stops[0].departures.length; i++) {
                        var route_color = compileDepartures.stops[0].departures[i].trip.route.route_color;
                        var route_text_color = compileDepartures.stops[0].departures[i].trip.route.route_text_color;
                        var route_desc_short = compileDepartures.stops[0].departures[i].trip.route.route_short_name;
                        var time_realtime = compileDepartures.stops[0].departures[i].arrival.estimated;
                        var time_scheduled = compileDepartures.stops[0].departures[i].arrival.scheduled;
                        var headsign_route = compileDepartures.stops[0].departures[i].trip.trip_headsign;

                        if (time_realtime === null) {
                            document.getElementById("route_depart").innerHTML = ` ${time_scheduled} (scheduled)`;
                            document.getElementById("route_depart").style.color = "black";
                        }
                        else if (time_scheduled === null) {
                            continue;
                        }
                        else {
                            document.getElementById("route_depart").innerHTML = ` ${time_realtime} <span id="delay">()</span>`;
                            document.getElementById("route_depart").style.color = "darkgreen";

                            if (time_realtime = compileDepartures.stops[0].departures[i].arrival.delay >= 60) {
                                document.getElementById("delay").innerHTML = `(${Math.floor(compileDepartures.stops[0].departures[i].arrival.delay / 60)} min late)`;
                                document.getElementById("delay").style.color = "crimson";
                            }
                            else if (time_realtime = compileDepartures.stops[0].departures[i].arrival.delay === 0) {
                                document.getElementById("delay").innerHTML = `(on time)`;
                                document.getElementById("delay").style.color = "green";
                            }
                            else if (time_realtime = compileDepartures.stops[0].departures[i].arrival.delay <= 0) {
                                document.getElementById("delay").innerHTML = `(${Math.abs(Math.floor(compileDepartures.stops[0].departures[i].arrival.delay / 60))} min early)`;
                                document.getElementById("delay").style.color = "skyblue";
                            }
                            else {
                                document.getElementById("delay").innerHTML = "(no data)";
                                document.getElementById("delay").style.color = "black";
                            }
                        }

                        document.getElementById("line_for_each_departure").innerHTML = route_desc_short;
                        document.getElementById("line_for_each_departure").style.backgroundColor = `#${route_color}40`;
                        document.getElementById("line_for_each_departure").style.border = `1px solid #${route_color}`;
                        document.getElementById("line_for_each_departure").style.color = `#${route_text_color}`;
                        document.getElementById("route_headsign").innerHTML = `<p id="isscroll">${headsign_route}</p>`;

                        if (deviceWidth <= 520 && document.getElementById("route_headsign").innerText.length > 35) {
                            console.log("Scroll?")
                            document.getElementById("isscroll").style.transform = "translateX(200vw)";
                            document.getElementById("isscroll").style.animation = "my-animation-6 10s linear infinite";
                        }

                        var departureClone = document.getElementById("line_for_departure");
                        var listToInsertClone = departureClone.cloneNode(true);
                        document.getElementById("list_of_departures").appendChild(listToInsertClone);

                        var alertList_byAgency = compileDepartures.stops[0].departures[i].trip.route.agency.alerts;
                        var alertList_byStop = compileDepartures.stops[0].alerts;

                        for (var j = 0; j < alertList_byAgency.length; j++) {
                            if (counter_b === alertList_byAgency.length) {
                                break;
                            }
                            document.getElementById("alert_entity").innerHTML = `<p>${alertList_byAgency[j].description_text[0].text}</p>`;
                            console.log(document.getElementById("alert_entity").textContent);

                            var alertClone = document.getElementById("alert_entity");
                            var listToInsertAlertClone = alertClone.cloneNode(true);
                            document.getElementById("list_of_alerts").appendChild(listToInsertAlertClone);
                            console.log(counter);
                            counter_b += 1
                        }

                        for (var k = 0; k < alertList_byStop.length; k++) {
                            if (counter === alertList_byStop.length) {
                                break;
                            }
                            document.getElementById("alert_entity").innerHTML = `<p>${alertList_byStop[k].description_text[0].text}</p>`;

                            var alertClone = document.getElementById("alert_entity");
                            var listToInsertAlertClone = alertClone.cloneNode(true);
                            document.getElementById("list_of_alerts").appendChild(listToInsertAlertClone);
                            console.log(counter);
                            counter += 1
                        }
                    }

                    var departuresAll = document.getElementById("list_of_departures").children;
                    document.querySelector("#list_of_departures").removeChild(departuresAll[0]);

                    var alertsAll = document.getElementById("list_of_alerts").children;
                    document.querySelector("#list_of_alerts").removeChild(alertsAll[0]);
                }
            }
            departureRequest.send();
        }

        function clearAllDepartures() {
            document.getElementById("list_of_departures").innerHTML = `
                <li id="line_for_departure"><div class="wrapper_for_departure"><div id="line_for_each_departure">-</div> <span id="route_headsign">(None)</span> <span id="route_depart">Enter a specific station by their stop ID</span></div></li>
            `
            document.getElementById("stationname").innerHTML = "---";
            document.getElementById("list_of_alerts").innerHTML = "<li id='alert_entity'></li>"
            document.getElementById("alert_entity").innerHTML = `<p>Once you typed down the station by their ID, the advisories will display here.</p>`
            counter = 0;
            counter_b = 0;
        }

        function keydownbus(e) {
            e = e || window.event;
            if (e.keyCode === 13) {
                callStopBus();
            }
        }

        function callStopBus() {
            var obtainValue = document.getElementById("busgetter").value;
            var stopCall = new XMLHttpRequest();
            stopCall.open("GET", `https://transit.land/api/v2/rest/stops?served_by_onestop_ids=o-9q9-vta&served_by_route_type=3&stop_id=${obtainValue}&api_key=x5unflDSbpKEWnThyfmteM8MHxIsg3eL`);
            stopCall.onreadystatechange = function() {
                if (stopCall.readyState === 4 && stopCall.status === 200) {
                    var stopId = JSON.parse(stopCall.responseText);
                    
                    if (stopId.stops.length === 0) {
                        document.getElementById("route_depart2").innerHTML = "There's no stop departures at this moment.";
                    }
                    else {
                        var stopIdSpecified = stopId.stops[0].stop_code;
                        var stopName = stopId.stops[0].stop_name;
                        
                        document.getElementById("stopname").innerHTML = stopName;
                        gatherDeparturesBus(stopIdSpecified);
                    }
                }
            }
            stopCall.send();
        }

        function gatherDeparturesBus(stopID_businput) {
            var departureRequest = new XMLHttpRequest();
            departureRequest.open("GET", `https://transit.land/api/v2/rest/stops/f-sf~bay~area~rg:${stopID_businput}/departures?api_key=x5unflDSbpKEWnThyfmteM8MHxIsg3eL&include_alerts=true`);
            departureRequest.onreadystatechange = function() {
                if (departureRequest.readyState === 4 && departureRequest.status === 200) {
                    var compileDepartures = JSON.parse(departureRequest.responseText);

                    for (var i = 0; i < compileDepartures.stops[0].departures.length; i++) {
                        var route_color = compileDepartures.stops[0].departures[i].trip.route.route_color;
                        var route_text_color = compileDepartures.stops[0].departures[i].trip.route.route_text_color;
                        var route_desc_short = compileDepartures.stops[0].departures[i].trip.route.route_short_name;
                        // var route_desc_long = compileDepartures.stops[0].departures[i].trip.route.route_long_name;
                        var time_realtime = compileDepartures.stops[0].departures[i].arrival.estimated;
                        var time_scheduled = compileDepartures.stops[0].departures[i].arrival.scheduled;
                        var headsign_route = compileDepartures.stops[0].departures[i].trip.trip_headsign;

                        if (time_realtime === null) {
                            document.getElementById("route_depart2").innerHTML = ` ${time_scheduled} (scheduled)`;
                            document.getElementById("route_depart2").style.color = "black";
                        }
                        else if (time_scheduled === null) {
                            continue;
                        }
                        else {
                            document.getElementById("route_depart2").innerHTML = ` ${time_realtime} <span id="delay2">()</span>`;
                            document.getElementById("route_depart2").style.color = "darkgreen";

                            if (time_realtime = compileDepartures.stops[0].departures[i].arrival.delay >= 60) {
                                document.getElementById("delay2").innerHTML = `(${Math.floor(compileDepartures.stops[0].departures[i].arrival.delay / 60)} min late)`;
                                document.getElementById("delay2").style.color = "crimson";
                            }
                            else if (time_realtime = compileDepartures.stops[0].departures[i].arrival.delay === 0) {
                                document.getElementById("delay2").innerHTML = `(on time)`;
                                document.getElementById("delay2").style.color = "green";
                            }
                            else if (time_realtime = compileDepartures.stops[0].departures[i].arrival.delay <= 0) {
                                document.getElementById("delay2").innerHTML = `(${Math.abs(Math.floor(compileDepartures.stops[0].departures[i].arrival.delay / 60))} min early)`;
                                document.getElementById("delay2").style.color = "skyblue";
                            }
                            else {
                                document.getElementById("delay2").innerHTML = "(no data)";
                                document.getElementById("delay2").style.color = "black";
                            }
                        }

                        document.getElementById("line_for_each_departure2").innerHTML = route_desc_short;
                        document.getElementById("line_for_each_departure2").style.backgroundColor = `#${route_color}40`;
                        document.getElementById("line_for_each_departure2").style.border = `1px solid #${route_color}`;
                        document.getElementById("line_for_each_departure2").style.color = `#${route_text_color}`;
                        document.getElementById("route_headsign2").innerHTML = `<p id="isscroll2">${headsign_route}</p>`;

                        if (deviceWidth <= 520 && document.getElementById("route_headsign2").innerText.length > 35) {
                            console.log("Scroll?")
                            document.getElementById("isscroll2").style.transform = "translateX(200vw)";
                            document.getElementById("isscroll2").style.animation = "my-animation-6 10s linear infinite";
                        }

                        var departureClone = document.getElementById("line_for_departure2");
                        var listToInsertClone = departureClone.cloneNode(true);
                        document.getElementById("list_of_departures2").appendChild(listToInsertClone);

                        var alertList_byAgency = compileDepartures.stops[0].departures[i].trip.route.agency.alerts;
                        var alertList_byStop = compileDepartures.stops[0].alerts;

                        for (var j = 0; j < alertList_byAgency.length; j++) {
                            if (counter_b === alertList_byAgency.length) {
                                break;
                            }
                            document.getElementById("alert_entity2").innerHTML = `<p>${alertList_byAgency[j].description_text[0].text}</p>`;
                            console.log(document.getElementById("alert_entity2").textContent);

                            var alertClone = document.getElementById("alert_entity2");
                            var listToInsertAlertClone = alertClone.cloneNode(true);
                            document.getElementById("list_of_alerts2").appendChild(listToInsertAlertClone);
                            console.log(counter);
                            counter_b += 1
                        }

                        for (var k = 0; k < alertList_byStop.length; k++) {
                            if (counter === alertList_byStop.length) {
                                break;
                            }
                            document.getElementById("alert_entity2").innerHTML = `<p>${alertList_byStop[k].description_text[0].text}</p>`;

                            var alertClone = document.getElementById("alert_entity2");
                            var listToInsertAlertClone = alertClone.cloneNode(true);
                            document.getElementById("list_of_alerts2").appendChild(listToInsertAlertClone);
                            console.log(counter);
                            counter += 1
                        }
                    }

                    var departuresAll = document.getElementById("list_of_departures2").children;
                    document.querySelector("#list_of_departures2").removeChild(departuresAll[0]);

                    var alertsAll = document.getElementById("list_of_alerts2").children;
                    document.querySelector("#list_of_alerts2").removeChild(alertsAll[0]);
                }
            }
            departureRequest.send();
        }

        function clearAllDepartures2() {
            document.getElementById("list_of_departures2").innerHTML = `
                <li id="line_for_departure2"><div class="wrapper_for_departure2"><div id="line_for_each_departure2">-</div> <span id="route_headsign2">(None)</span> <span id="route_depart2">Enter a specific station by their stop ID</span></div></li>
            `
            document.getElementById("stopname").innerHTML = "---";
            document.getElementById("list_of_alerts2").innerHTML = "<li id='alert_entity2'></li>"
            document.getElementById("alert_entity2").innerHTML = `<p>Once you typed down the station by their ID, the advisories will display here.</p>`
            counter = 0;
            counter_b = 0;
        }
    </script>
</body>

</html>